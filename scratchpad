
import warnings
warnings.filterwarnings("ignore")
import fhmm_support as fhm
import numpy as np
import pandas as pd
np.random.seed(123)
import matplotlib.pyplot as plt
from collections import OrderedDict
from hmmlearn import hmm
from IPython import embed
import time
import pandas.rpy.common as com
import rpy2.robjects as rob
rsource = rob.r['source']


# List all houses in a directory
dir = "/Volumes/MacintoshHD2/Users/haroonr/Detailed_datasets/Dataport/mix_homes/default_3months/"


houses = [f for f in os.listdir(dir)]
df = pd.read_csv(dir+houses[6],index_col='localminute') # USE HOUSE (6,115) 
df.index = pd.to_datetime(df.index)

df = df["2014-06-01":"2014-08-30"]
res = df.sum(axis=0)
high_energy_apps = res.nlargest(6).keys() # CONTROL : selects few applainces
df_new = df[high_energy_apps]
del df_new['use']# drop stale aggregate column
df_new['use'] = df_new.sum(axis=1) # create new aggregate column
rsource('/Volumes/MacintoshHD2/Users/haroonr/Dropbox/nilmtk_work/localize_support.R')
#create_model = rob.r('create_model')
#df_new2 = com.convert_to_r_dataframe(df_new.use)
#create_model(df_new2)

l = pd.DataFrame(data={'localminute': df_new.index,'power' : df_new.use.values})
#l.columns = ["localminute","power"]
#df_new2 = com.convert_to_r_dataframe(l)
#create_model(df_new2)

from rpy2.robjects import pandas2ri
pandas2ri.activate()
pob =  pandas2ri.py2ri(l)
rsource('/Volumes/MacintoshHD2/Users/haroonr/Dropbox/nilmtk_work/localize_support.R')
create_model = rob.r('create_model')
res = create_model(pob)[0]







